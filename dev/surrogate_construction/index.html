<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Surrogate Construction · SPRFittingPaper2023.jl</title><meta name="title" content="Surrogate Construction · SPRFittingPaper2023.jl"/><meta property="og:title" content="Surrogate Construction · SPRFittingPaper2023.jl"/><meta property="twitter:title" content="Surrogate Construction · SPRFittingPaper2023.jl"/><meta name="description" content="Documentation for SPRFittingPaper2023.jl."/><meta property="og:description" content="Documentation for SPRFittingPaper2023.jl."/><meta property="twitter:description" content="Documentation for SPRFittingPaper2023.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">SPRFittingPaper2023.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../forward_simulation/">Forward Model</a></li><li class="is-active"><a class="tocitem" href>Surrogate Construction</a><ul class="internal"><li><a class="tocitem" href="#Setup"><span>Setup</span></a></li><li><a class="tocitem" href="#Serial-Surrogate-Construction"><span>Serial Surrogate Construction</span></a></li><li><a class="tocitem" href="#Surrogate-Format"><span>Surrogate Format</span></a></li><li><a class="tocitem" href="#Parallel-Surrogate-Construction"><span>Parallel Surrogate Construction</span></a></li><li><a class="tocitem" href="#Bibliography"><span>Bibliography</span></a></li></ul></li><li><a class="tocitem" href="../SPRFitting_api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Surrogate Construction</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Surrogate Construction</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/isaacsas/SPRFittingPaper2023.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/isaacsas/SPRFittingPaper2023.jl/blob/main/docs/src/surrogate_construction.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Surrogate-Model-Construction"><a class="docs-heading-anchor" href="#Surrogate-Model-Construction">Surrogate Model Construction</a><a id="Surrogate-Model-Construction-1"></a><a class="docs-heading-anchor-permalink" href="#Surrogate-Model-Construction" title="Permalink"></a></h1><p>In this tutorial we will illustrate how to construct a (small) surrogate in serial on any computer, and our workflow for building large surrogates on clusters (specific to the Grid Engine queuing system based cluster we use).</p><h2 id="Setup"><a class="docs-heading-anchor" href="#Setup">Setup</a><a id="Setup-1"></a><a class="docs-heading-anchor-permalink" href="#Setup" title="Permalink"></a></h2><p>We begin by installing the packages we need in a clean environment:</p><pre><code class="language-julia hljs">using Pkg

# create a new environment for the surrogate constructions
Pkg.activate(&quot;surrogate_env&quot;) 
Pkg.add(url=&quot;https://github.com/isaacsas/SPRFittingPaper2023.jl.git&quot;)
Pkg.add(&quot;JLD&quot;)</code></pre><h2 id="Serial-Surrogate-Construction"><a class="docs-heading-anchor" href="#Serial-Surrogate-Construction">Serial Surrogate Construction</a><a id="Serial-Surrogate-Construction-1"></a><a class="docs-heading-anchor-permalink" href="#Serial-Surrogate-Construction" title="Permalink"></a></h2><p>We first demonstrate how to build a (small) surrogate in serial (i.e. on a single CPU core). We start by loading the needed packages:</p><pre><code class="language-julia hljs">using SPRFittingPaper2023, JLD

# import a useful but non-exported function:
using SPRFittingPaper2023</code></pre><p>We next define the parameter ranges we wish to tabulate the surrogate over. Reaction rates are specified via a range in <strong><code>log10</code></strong> space, i.e. <code>log10(kon)</code>, <code>log10(koff)</code>, and <code>log10(konb)</code>. The reach is specified in linear space:</p><pre><code class="language-julia hljs">logkon_range  = (-3.0, 2.0)
logkoff_range = (-4.0, -1.0)
logkonb_range = (-3.0, 1.5)
reach_range   = (2.0, 35.0)   # in nm
surpars = SurrogateParams(; logkon_range, logkoff_range, logkonb_range, reach_range)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SurrogateParams{Float64}
logkon_range = (-3.0, 2.0)
logkoff_range = (-4.0, -1.0)
logkonb_range = (-3.0, 1.5)
reach_range = (2.0, 35.0)
[antigen] = 125.23622683286348
[antibody] = 1.0
CP = 1.0</code></pre><p>We collect these parameters into a <a href="../SPRFitting_api/#SPRFittingPaper2023.SurrogateParams"><code>SurrogateParams</code></a> structure. Note that here we will build the surrogate with a fixed internal antibody concentration of <code>1.0</code> nM and antigen concentration of</p><pre><code class="language-julia hljs">SPRFittingPaper2023.DEFAULT_SIM_ANTIGENCONCEN</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">125.23622683286348</code></pre><p>in units of μM. This is feasible to do because the antibody concentration only arises in product with <span>$k_{\text{on}}$</span>, so when fitting we can (internally) interpret the surrogate <code>logkon</code> values as representing <span>$\log_{10}(k_{\text{on}} [\text{Ab}])$</span>. Similarly, as explained in the methods section of [1], using a fixed antigen concentration is not problematic as we can analytically transform any fit reach value using the internal antigen concentration to a physical reach value corresponding to the true experimental antigen concentration. </p><p>Next we specify temporal information for the surrogate:</p><pre><code class="language-julia hljs">tstop      = 600.0               # simulation end time
tsavelen   = 601                 # number of time points to save (must be integer currently)
tstop_AtoB = 150.0               # time to remove free antibodies
tsave = collect(range(0.0, tstop, tsavelen))  # times to save at
simpars = SimParams(; tstop, tstop_AtoB, tsave)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SimParams{Float64, 3}
number of particles (N) = 1000
tstop = 600.0
tstop_AtoB = 150.0
number of save points = 601
domain length (L) = 236.68625663347206
resample_initlocs = true
nsims = 1000</code></pre><p>We collect these parameters into a <a href="../SPRFitting_api/#SPRFittingPaper2023.SimParams"><code>SimParams</code></a> object. Note that it contains many other parameters for which we typically just use the default value when building a surrogate (for example, by default distributing antigen particles uniformly within a cube). The default number of antigen is</p><pre><code class="language-julia hljs">simpars.N</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1000</code></pre><p>Finally, we specify how many points to tabulate over for each of the four parameters. Parameters are spaced uniformly in <code>log10</code> space for the rates and linear space for the reach:</p><pre><code class="language-julia hljs"># here the order is number of points for
# [logkon, logkoff, logkonb, reach, time]
surrogate_size = (3, 3, 3, 3, tsavelen)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(3, 3, 3, 3, 601)</code></pre><p>Note, this is a very small surrogate, which we would not use in any practical fitting assay. More typical values are given in our manuscript (often 30-50 points per parameter).</p><p>We are now ready to build and save the surrogate</p><pre><code class="language-julia hljs">outfile = tempname()  # just use a temporary file name
save_surrogate(outfile, surrogate_size, surpars, simpars)</code></pre><p>Note that the surrogate by default saves curves that correspond to the </p><p class="math-container">\[\frac{\text{average number of bound antibodies}}{\text{ the number of antigen in the system}}.\]</p><h2 id="Surrogate-Format"><a class="docs-heading-anchor" href="#Surrogate-Format">Surrogate Format</a><a id="Surrogate-Format-1"></a><a class="docs-heading-anchor-permalink" href="#Surrogate-Format" title="Permalink"></a></h2><p>The surrogate is stored in a Julia <a href="https://github.com/JuliaIO/JLD.jl">JLD</a> file. We can see the raw data in the surrogate via the JLD <code>load</code> command:</p><pre><code class="language-julia hljs">surdata = load(outfile)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{String, Any} with 15 entries:
  &quot;CP&quot;             =&gt; 1.0
  &quot;logkonb_range&quot;  =&gt; (-3.0, 1.5)
  &quot;FirstMoment&quot;    =&gt; [0.0 0.0 0.0; 0.0 0.0 0.0; 0.0 0.0 0.0;;; 0.0 0.0 0.0; 0.…
  &quot;logkoff_range&quot;  =&gt; (-4.0, -1.0)
  &quot;L&quot;              =&gt; 236.686
  &quot;surrogate_size&quot; =&gt; (3, 3, 3, 3, 601)
  &quot;antibodyconcen&quot; =&gt; 1.0
  &quot;tstop&quot;          =&gt; 600.0
  &quot;antigenconcen&quot;  =&gt; 125.236
  &quot;DIM&quot;            =&gt; 3
  &quot;N&quot;              =&gt; 1000
  &quot;logkon_range&quot;   =&gt; (-3.0, 2.0)
  &quot;reach_range&quot;    =&gt; (2.0, 35.0)
  &quot;tsave&quot;          =&gt; [0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0  …  591…
  &quot;tstop_AtoB&quot;     =&gt; 150.0</code></pre><p>To access a given field we can say</p><pre><code class="language-julia hljs">surdata[&quot;tstop&quot;]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">600.0</code></pre><p>In particular, <code>surdata[&quot;FirstMoment&quot;]</code> will correspond to the table of solution curves.</p><p>To load the surrogate for use in fitting we instead use</p><pre><code class="language-julia hljs">sur = Surrogate(outfile)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Surrogate{NTuple{5, Int64}, Interpolations.BSplineInterpolation{Float64, 5, Array{Float64, 5}, Interpolations.BSpline{Interpolations.Linear{Interpolations.Throw{Interpolations.OnGrid}}}, NTuple{5, Base.OneTo{Int64}}}, Float64, Float64, 3}((3, 3, 3, 3, 601), [0.0 0.0 0.0; 0.0 0.0 0.0; 0.0 0.0 0.0;;; 0.0 0.0 0.0; 0.0 0.0 0.0; 0.0 0.0 0.0;;; 0.0 0.0 0.0; 0.0 0.0 0.0; 0.0 0.0 0.0;;;; 0.0 0.0 0.0; 0.0 0.0 0.0; 0.0 0.0 0.0;;; 0.0 0.0 0.0; 0.0 0.0 0.0; 0.0 0.0 0.0;;; 0.0 0.0 0.0; 0.0 0.0 0.0; 0.0 0.0 0.0;;;; 0.0 0.0 0.0; 0.0 0.0 0.0; 0.0 0.0 0.0;;; 0.0 0.0 0.0; 0.0 0.0 0.0; 0.0 0.0 0.0;;; 0.0 0.0 0.0; 0.0 0.0 0.0; 0.0 0.0 0.0;;;;; 0.0009960000000000004 0.0009639999999999995 0.0010440000000000007; 0.2723076923076924 0.2747631578947368 0.25865200000000005; 1.0 0.9999591836734694 0.9990000000000004;;; 0.001028 0.0009440000000000008 0.0009320000000000003; 0.27099999999999996 0.27373333333333333 0.2574839999999998; 1.0 0.99996875 0.9989800000000002;;; 0.0010640000000000003 0.0009439999999999995 0.0010039999999999997; 0.26918749999999997 0.2722916666666668 0.2557800000000001; 0.9996666666666667 0.9997500000000001 0.9986520000000001;;;; 0.0010520000000000002 0.0009320000000000001 0.00096; 0.27468421052631575 0.27216666666666667 0.25704399999999983; 1.0 1.0 0.9991480000000003;;; 0.0010400000000000003 0.0009039999999999999 0.0009839999999999998; 0.2673333333333333 0.26554545454545453 0.2560680000000001; 0.9985333333333333 0.9987333333333333 0.9972399999999997;;; 0.001052000000000001 0.0010040000000000006 0.0009360000000000003; 0.24115789473684215 0.24217948717948717 0.2380952380952381; 0.8427333333333333 0.8417333333333334 0.8429411764705882;;;; 0.000996 0.000984 0.0009400000000000002; 0.2732333333333333 0.26839393939393946 0.2580159999999998; 0.9999333333333333 0.9998 0.9990120000000001;;; 0.0009920000000000003 0.0010240000000000004 0.0009360000000000001; 0.2522 0.2537826086956521 0.24740799999999996; 0.9874666666666666 0.9899333333333333 0.9872720000000001;;; 0.0009280000000000002 0.0008679999999999998 0.0009999999999999996; 0.23625925925925928 0.23556 0.23920000000000002; 0.6236 0.6217333333333334 0.6422;;;;; 0.0018200000000000009 0.001936 0.001960000000000001; 0.47142307692307683 0.47100000000000003 0.42918000000000023; 1.0 0.9999591836734693 0.9989560000000001;;; 0.0019359999999999991 0.0020399999999999984 0.0016639999999999988; 0.468741935483871 0.46736666666666665 0.42904400000000015; 1.0 1.0 0.999064;;; 0.0019720000000000007 0.0019759999999999995 0.0019719999999999985; 0.4725 0.46860416666666654 0.4273919999999998; 0.9996666666666667 0.9997083333333334 0.998636;;;; 0.0020959999999999993 0.0018319999999999996 0.0018320000000000005; 0.46994736842105267 0.4694333333333333 0.42911999999999995; 1.0 0.9999583333333333 0.9989319999999994;;; 0.002040000000000001 0.0019080000000000006 0.0018639999999999993; 0.4503030303030303 0.4461818181818182 0.41862800000000006; 0.9985333333333333 0.9987333333333333 0.9972119999999999;;; 0.0020760000000000006 0.001959999999999999 0.001856; 0.3796315789473685 0.3837179487179488 0.37038095238095237; 0.8427333333333333 0.8422 0.8469411764705882;;;; 0.0020039999999999997 0.001976 0.001903999999999998; 0.4689333333333333 0.46284848484848495 0.42817999999999995; 0.9999333333333333 0.9999333333333332 0.9989040000000001;;; 0.0018759999999999996 0.0021360000000000025 0.0019119999999999981; 0.39916 0.3984347826086957 0.386928; 0.9874666666666666 0.9899333333333333 0.9872800000000004;;; 0.0019320000000000001 0.0018760000000000003 0.002068000000000002; 0.35759259259259263 0.35712 0.36133333333333334; 0.6236666666666667 0.6225999999999999 0.6553333333333333;;;;; … ;;;;; 0.13282399999999994 0.027656000000000007 0.0; 0.9570384615384616 0.24115789473684213 0.0; 0.9522666666666667 0.24416326530612245 0.0;;; 0.13226000000000007 0.027215999999999994 0.0; 0.9559032258064518 0.23956666666666665 0.0; 0.9556 0.24696875000000004 0.0;;; 0.13218400000000002 0.02759999999999999 0.0002600000000000001; 0.952875 0.24014583333333334 0.0008040000000000004; 0.9554666666666666 0.23954166666666668 0.0009119999999999999;;;; 0.13411599999999996 0.03810400000000001 0.0; 0.9503157894736842 0.2672333333333334 0.0; 0.9528000000000001 0.27433333333333343 0.0;;; 0.1312959999999999 0.10912800000000007 0.0; 0.7675454545454545 0.4292121212121211 8.000000000000001e-6; 0.9595333333333333 0.44466666666666665 1.2e-5;;; 0.13071999999999998 0.114768 0.090628; 0.6299999999999999 0.4362051282051282 0.29442857142857143; 0.8135333333333332 0.4498666666666667 0.28382352941176475;;;; 0.13382400000000003 0.071508 0.0; 0.9373666666666668 0.3560303030303031 0.0; 0.9572666666666668 0.3534 0.0;;; 0.128228 0.1285280000000001 0.002564000000000002; 0.57968 0.4928695652173913 0.008587999999999993; 0.9468666666666666 0.5210666666666665 0.008900000000000002;;; 0.12970799999999988 0.130184 0.12469600000000007; 0.520185185185185 0.4968 0.40906666666666675; 0.6154 0.5078666666666667 0.4093333333333334;;;;; 0.13280800000000006 0.02758 0.0; 0.9569230769230771 0.240421052631579 0.0; 0.9520666666666666 0.24336734693877551 0.0;;; 0.13225600000000004 0.027111999999999987 0.0; 0.9558709677419355 0.2387666666666667 0.0; 0.9554666666666667 0.2463125 0.0;;; 0.13217200000000004 0.027492000000000003 0.0002600000000000001; 0.9528125000000001 0.23945833333333327 0.0007999999999999998; 0.9554666666666666 0.23858333333333334 0.0009119999999999999;;;; 0.13410399999999983 0.03797600000000001 0.0; 0.9501578947368422 0.26669999999999994 0.0; 0.9527333333333334 0.2737083333333333 0.0;;; 0.1312959999999999 0.10910000000000002 0.0; 0.7674848484848485 0.4290000000000001 8.000000000000001e-6; 0.9594000000000001 0.44433333333333336 4.000000000000001e-6;;; 0.13071999999999998 0.114752 0.09059599999999997; 0.6299473684210526 0.435974358974359 0.29433333333333334; 0.8134666666666667 0.44966666666666666 0.2836470588235294;;;; 0.13382400000000003 0.071432 0.0; 0.9372666666666667 0.35542424242424236 0.0; 0.9572666666666668 0.353 0.0;;; 0.128228 0.12852400000000014 0.002548; 0.57964 0.4927391304347826 0.008512000000000004; 0.9467333333333334 0.5209333333333334 0.008839999999999992;;; 0.12970799999999988 0.130184 0.12468000000000007; 0.520185185185185 0.4968 0.40900000000000003; 0.6154 0.5078 0.4091333333333334;;;;; 0.13279200000000013 0.027503999999999987 0.0; 0.9567307692307693 0.23981578947368418 0.0; 0.9519333333333333 0.24271428571428572 0.0;;; 0.13225200000000004 0.02699999999999998 0.0; 0.9558064516129032 0.23800000000000002 0.0; 0.9554 0.24562499999999998 0.0;;; 0.13216800000000006 0.02741999999999998 0.0002600000000000001; 0.95275 0.23858333333333337 0.0007999999999999998; 0.9554000000000001 0.2375 0.0009119999999999999;;;; 0.1340959999999999 0.037896000000000006 0.0; 0.9500526315789473 0.2659666666666667 0.0; 0.9526000000000001 0.2730833333333333 0.0;;; 0.1312959999999999 0.10907999999999997 0.0; 0.7674242424242425 0.42854545454545456 8.000000000000001e-6; 0.9592666666666668 0.4440666666666666 4.000000000000001e-6;;; 0.13070399999999996 0.114744 0.09054799999999999; 0.6299473684210526 0.4358461538461538 0.29414285714285715; 0.8134 0.4492666666666667 0.2835294117647059;;;; 0.13382400000000003 0.07138000000000004 0.0; 0.9372666666666667 0.354909090909091 0.0; 0.9570666666666667 0.3526666666666667 0.0;;; 0.128228 0.12852400000000014 0.0025200000000000014; 0.57964 0.49265217391304345 0.00846; 0.9467333333333334 0.5207333333333333 0.008764000000000011;;; 0.12970799999999988 0.130184 0.12467199999999998; 0.520185185185185 0.4968 0.40900000000000003; 0.6154 0.5078 0.4090666666666667], SurrogateParams{Float64}((-3.0, 2.0), (-4.0, -1.0), (-3.0, 1.5), (2.0, 35.0), 125.23622683286348, 1.0, 1.0), SimParams{Float64, 3}(1000, 600.0, 150.0, [0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0  …  591.0, 592.0, 593.0, 594.0, 595.0, 596.0, 597.0, 598.0, 599.0, 600.0], 236.68625663347206, StaticArraysCore.SVector{3, Float64}[[-33.166737514021605, 53.65183596189922, 6.577815647069414], [-31.109585108786646, -63.554452188395075, 9.285588597180109], [-17.43770848294318, -34.95531611254273, -84.2222033268933], [62.786057563940574, -91.79760168357438, -92.71211950119256], [38.471967709676306, -102.69344676870121, -81.74043480661112], [-30.169715902243766, -0.3947425114964318, 72.61042888471547], [-63.215179826780286, 100.02052708875527, -84.38302255097578], [-84.19872855713265, -78.04533157724373, 43.540766423046364], [117.56490875199376, -10.796770162947666, -67.03041654286768], [64.46474635477341, 111.01568370583786, -84.5049022044596]  …  [-40.71585000687767, -109.53898152587041, 24.07471623824614], [6.196067653197417, 99.95839443952903, -48.034563721868096], [-84.50940627556653, -117.1119727649993, 54.90756977271218], [45.7723355166992, -62.05374127621234, -37.81166435051367], [-55.86126818125219, -22.748914919440153, -87.20536405631297], [-106.55397042723487, -69.30843604269238, -51.54166773541239], [-27.337041874162693, -6.46214442775252, 67.94530009013113], [-11.638412672140134, 45.951322853767465, -112.7171771931499], [-73.21890603410634, -16.396972068218886, -105.70044498879248], [15.19888398585573, 39.715765551937636, 92.47096671080729]], true, 1000))</code></pre><p>The use of the loaded surrogate for fitting will be illustrated in the next tutorial.</p><h2 id="Parallel-Surrogate-Construction"><a class="docs-heading-anchor" href="#Parallel-Surrogate-Construction">Parallel Surrogate Construction</a><a id="Parallel-Surrogate-Construction-1"></a><a class="docs-heading-anchor-permalink" href="#Parallel-Surrogate-Construction" title="Permalink"></a></h2><p>Below we explain our workflow for constructing the surrogate via parallel simulations using the Grid Engine queuing system. The basic workflow and scripts we link were designed for this system, but should be adaptable to other queue-based  clusters.</p><p>The basic approach is </p><ol><li>Save a metadata file with all information needed to build the surrogate.</li><li>Construct pieces of the surrogate as independent single-core jobs on the cluster.</li><li>Merge the pieces of the surrogate back together into a single complete surrogate.</li></ol><p>The surrogate used in [1] can be downloaded from <a href="https://doi.org/10.6084/m9.figshare.26936854">here</a>. Below we give the basic scripts and commands used in its construction (note constructing such a surrogate generally requires in total 500-2000 hours of cpu time on the Boston University cluster).</p><p>Our workflow is</p><ol><li>Edit <a href="../parallel_surrogate_files/make_surrogate_metadata.jl">&quot;make_surrogate_metadata.jl&quot;</a> for your system and then run it in Julia (via <code>include(&quot;make_surrogate_metadata.jl&quot;)</code>).</li><li>Edit the bash scripts <a href="../parallel_surrogate_files/queue_job.sh">&quot;queue_job.sh&quot;</a> and <a href="../parallel_surrogate_files/run_sim.sh">&quot;run_sim.sh&quot;</a> for your system as appropriate and run queue_job.sh to submit the parallel surrogate jobs.</li><li>After all jobs finish, edit <a href="../parallel_surrogate_files/merge_surrogate_slices.jl">&quot;merge_surrogate_slices.jl&quot;</a> as appropriate and run it in Julia via <code>include(&quot;merge_surrogate_slices.jl&quot;)</code> to merge the output from each cluster job into one complete surrogate. </li></ol><p>The linked scripts should correspond to those used to construct the surrogate in [1].</p><h2 id="Bibliography"><a class="docs-heading-anchor" href="#Bibliography">Bibliography</a><a id="Bibliography-1"></a><a class="docs-heading-anchor-permalink" href="#Bibliography" title="Permalink"></a></h2><ol><li>A. Huhn, D. Nissley, ..., C. M. Deane, S. A. Isaacson, and O. Dushek, <em>Analysis of emergent bivalent antibody binding identifies the molecular reach as a critical determinant of SARS-CoV-2 neutralisation potency</em>, in review, <a href="https://www.biorxiv.org/content/10.1101/2023.09.06.556503v2">available on bioRxiv</a> (2024).</li></ol></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../forward_simulation/">« Forward Model</a><a class="docs-footer-nextpage" href="../SPRFitting_api/">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Monday 9 September 2024 21:29">Monday 9 September 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
