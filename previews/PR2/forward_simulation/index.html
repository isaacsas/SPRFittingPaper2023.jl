<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Forward Model · SPRFittingPaper2023.jl</title><meta name="title" content="Forward Model · SPRFittingPaper2023.jl"/><meta property="og:title" content="Forward Model · SPRFittingPaper2023.jl"/><meta property="twitter:title" content="Forward Model · SPRFittingPaper2023.jl"/><meta name="description" content="Documentation for SPRFittingPaper2023.jl."/><meta property="og:description" content="Documentation for SPRFittingPaper2023.jl."/><meta property="twitter:description" content="Documentation for SPRFittingPaper2023.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">SPRFittingPaper2023.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Forward Model</a><ul class="internal"><li><a class="tocitem" href="#Tutorial-Setup"><span>Tutorial Setup</span></a></li><li><a class="tocitem" href="#Running-Forward-Simulations"><span>Running Forward Simulations</span></a></li></ul></li><li><a class="tocitem" href="../surrogate_construction/">Surrogate Construction</a></li><li><a class="tocitem" href="../SPRFitting_api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Forward Model</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Forward Model</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/isaacsas/SPRFittingPaper2023.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/isaacsas/SPRFittingPaper2023.jl/blob/main/docs/src/forward_simulation.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Forward-Model-Simulation"><a class="docs-heading-anchor" href="#Forward-Model-Simulation">Forward Model Simulation</a><a id="Forward-Model-Simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Forward-Model-Simulation" title="Permalink"></a></h1><p>In this tutorial we will show how to run forward model simulations given a set of parameters and plot the amount of bound antibodies.</p><h2 id="Tutorial-Setup"><a class="docs-heading-anchor" href="#Tutorial-Setup">Tutorial Setup</a><a id="Tutorial-Setup-1"></a><a class="docs-heading-anchor-permalink" href="#Tutorial-Setup" title="Permalink"></a></h2><p>Let&#39;s first install the packages we need in a clean environment:</p><pre><code class="language-julia hljs">using Pkg

# create a new environment for the forward model simulation
Pkg.activate(&quot;fwd_sim_env&quot;) 
Pkg.add(url=&quot;https://github.com/isaacsas/SPRFittingPaper2023.jl.git&quot;)
Pkg.add(&quot;Plots&quot;)
Pkg.add(&quot;CSV&quot;&quot;</code></pre><h2 id="Running-Forward-Simulations"><a class="docs-heading-anchor" href="#Running-Forward-Simulations">Running Forward Simulations</a><a id="Running-Forward-Simulations-1"></a><a class="docs-heading-anchor-permalink" href="#Running-Forward-Simulations" title="Permalink"></a></h2><p>We begin by loading the needed packages:</p><pre><code class="language-julia hljs">using SPRFittingPaper2023, Plots, CSV

# import a useful but non-exported function:
using SPRFittingPaper2023: means</code></pre><p>We next specify the needed model parameters. We will vary the antibody concentration to generate a sequence of curves to model a series of experiments that increase the antibody concentration. The parameters we use will be those that we previously fit to an FD11A-RBD binding experiment.</p><p>We will begin using a 3D model in which antigen are randomly distributed within a cube, our standard model for bivalent SPR experiments. We first specify the biophysical parameters to use in our simulations and collect them in a <a href="../SPRFitting_api/#SPRFittingPaper2023.BioPhysParams"><code>BioPhysParams</code></a> structure:</p><pre><code class="language-julia hljs">antigenconcen   = 13.8           # assumed in μM
antibodyconcens = [25.0, 100.0]  # assumed in nM
kon = 5.286e-05                  # assumed in 1 / (nM * sec)
koff = 0.040868575               # assumed in 1 / sec
konb =  0.7801815                # assumed in 1 / sec
reach = 31.89884387              # assumed in nm
CP = 128.569235     # coefficient of proportionality to fit the SPR data
biopars = BioPhysParams(; kon, koff, konb, reach, antigenconcen, CP,
                        antibodyconcen = antibodyconcens[1])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">BioPhysParams{Float64}
kon = 5.286e-5
koff = 0.040868575
konb = 0.7801815
reach = 31.89884387
CP = 128.569235
[antigen] = 13.8
[antibody] = 25.0</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Throughout the library, all reported <span>$k_{\text{on}}$</span> values represent the total bimolecular rate for the binding of free antibodies in solution to an antigen, i.e the <span>$A_i \overset{k_{\text{on}} [\text{Ab}]}{\to} B_i$</span> reaction, and hence are double the physical <span>$k_{\text{on}}$</span> defined in our manuscript (where we assume <span>$k_{\text{on}}$</span> is the rate associated with an individual Fab, i.e. <span>$A_i \overset{2 k_{\text{on}} [\text{Ab}]}{\to} B_i$</span>).</p></div></div><p>Next we specify simulation parameters. Note, as we gave concentrations for the antigen and specify the number of particles to use, this fully determines the domain size (which is calculated for us automatically):</p><pre><code class="language-julia hljs">tstop = 600.0        # time in seconds
tstop_AtoB = 150.0    # time to remove free antibodies at
dt = 1.0              # times at which we save the data
N = 1000              # number of antigen particles to use
simpars = SimParams(; antigenconcen = biopars.antigenconcen, tstop, dt, N,
                      DIM = 3, tstop_AtoB)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SimParams{Float64, 3}
number of particles (N) = 1000
tstop = 600.0
tstop_AtoB = 150.0
number of save points = 601
domain length (L) = 493.69266003600563
resample_initlocs = true
nsims = 1000</code></pre><p>See the <a href="../SPRFitting_api/#SPRFittingPaper2023.SimParams"><code>SimParams</code></a> documentation for more on what the various arguments here mean.</p><p>Finally, for each antibody concentration we will run one forward simulation and plot the ratio of the number of bound antibodies to the number of antigen, scaled by the fitted coefficient of proportionality, <code>CP</code>:</p><pre><code class="language-julia hljs">plt = plot(; xlabel = &quot;times (sec)&quot;,
             ylabel = &quot;SPR Response&quot;)
for abc in antibodyconcens
    biopars.antibodyconcen = abc
    tbo = TotalBoundOutputter(length(simpars.tsave))
    run_spr_sim!(tbo, biopars, simpars)
    bindcnt = means(tbo)
    plot!(plt, simpars.tsave, bindcnt; lw = 2,
          label = &quot;[Ab] = $(biopars.antibodyconcen) (simulation)&quot;)
end

plt</code></pre><img src="1e217be9.svg" alt="Example block output"/><p>Note that here we only ran one simulation for each parameter set, and hence <code>means</code> just returns the <code>CP</code> scaled number of antibodies bound to the surface at each time in <code>tsave</code> divided by the number of antigen in the system (i.e. <code>N = 1000</code> here). If we had wanted to run and average multiple samples we could have passed <a href="../SPRFitting_api/#SPRFittingPaper2023.run_spr_sim!"><code>run_spr_sim!</code></a> a terminator such as a <a href="../SPRFitting_api/#SPRFittingPaper2023.VarianceTerminator"><code>SPRFittingPaper2023.VarianceTerminator</code></a> or <a href="../SPRFitting_api/#SPRFittingPaper2023.SimNumberTerminator"><code>SPRFittingPaper2023.SimNumberTerminator</code></a>.</p><p>Finally, let&#39;s load and plot the corresponding aligned SPR data that we originally estimated these parameters from to confirm the good fit. </p><pre><code class="language-julia hljs">datadir = joinpath(@__DIR__, &quot;..&quot;, &quot;..&quot;, &quot;data&quot;)
fname = joinpath(datadir, &quot;Data_FC4_10-05-22_Protein07_FD-11A_RBD-13.8_aligned.csv&quot;)
ad = get_aligned_data(fname)
for (i, times) in enumerate(ad.times)
    plot!(plt, times, ad.refdata[i]; linestyle = :dash, lw = 2,
          label = &quot;[Ab] = $(ad.antibodyconcens[i]), (data)&quot;)
end
plt</code></pre><img src="3bfba51d.svg" alt="Example block output"/></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../surrogate_construction/">Surrogate Construction »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Monday 9 September 2024 20:55">Monday 9 September 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
